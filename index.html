<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neon Dash</title>

<style>
body{
 margin:0;
 background:#050510;
 font-family:Arial;
 overflow:hidden;
 color:#0ff;
}
canvas{
 display:none;
 margin:auto;
 background:#050510;
}
.menu,.shop{
 position:absolute;
 inset:0;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 background:radial-gradient(circle,#0a0a25,#000);
}
button{
 font-size:18px;
 padding:12px 28px;
 margin:8px;
 background:#0ff;
 border:none;
 color:#000;
 box-shadow:0 0 20px #0ff;
 border-radius:8px;
}
h1,h2{
 text-shadow:0 0 25px #0ff;
}
input[type=color]{
 width:60px;
 height:40px;
 margin:5px;
 border:none;
}
</style>
</head>

<body>

<div class="menu" id="menu">
 <h1>NEON DASH</h1>
 <button onclick="startGame()">‚ñ∂ –ò–ì–†–ê–¢–¨</button>
 <button onclick="openShop()">üõí –ú–ê–ì–ê–ó–ò–ù</button>
 <p>–ú–æ–Ω–µ—Ç—ã: <span id="coinsText">0</span></p>
</div>

<div class="shop" id="shop" style="display:none">
 <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
 <p>–ú–æ–Ω–µ—Ç—ã: <span id="coinsText2">0</span></p>

 <button onclick="buyColor()">–ö—É–ø–∏—Ç—å –Ω–µ–æ–Ω-—Ü–≤–µ—Ç (20)</button>

 <div>
  –¶–≤–µ—Ç 1 <input type="color" id="c1">
  –¶–≤–µ—Ç 2 <input type="color" id="c2">
  –ì–ª–∞–∑–∞ <input type="color" id="eyes">
 </div>

 <button onclick="saveSkin()">–°–û–•–†–ê–ù–ò–¢–¨</button>
 <button onclick="closeShop()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<canvas id="game" width="360" height="520"></canvas>

<script>
// ===== –ü–†–û–ì–†–ï–°–° =====
let coins = Number(localStorage.coins || 0);
let owned = JSON.parse(localStorage.owned || '{"c1":true,"c2":false}');
let skin = JSON.parse(localStorage.skin || '{"body1":"#00ffff","body2":"#00aaff","eyes":"#ffffff"}');

coinsText.textContent = coins;
coinsText2.textContent = coins;

c1.value = skin.body1;
c2.value = skin.body2;
eyes.value = skin.eyes;

// ===== CANVAS =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===== –ò–ì–†–ê =====
let y, vy, dead;
let gravity = 0.9;
let speed = 6;
let progress = 0;
const LEVEL_LENGTH = 2500;

let spikes = [];
let platforms = [];
let particles = [];

// ===== –ó–í–£–ö =====
function explosionSound(){
 const a = new AudioContext();
 const o = a.createOscillator();
 const g = a.createGain();
 o.type="sawtooth";
 o.frequency.setValueAtTime(200,a.currentTime);
 o.frequency.exponentialRampToValueAtTime(40,a.currentTime+0.4);
 g.gain.setValueAtTime(0.6,a.currentTime);
 g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+0.4);
 o.connect(g); g.connect(a.destination);
 o.start(); o.stop(a.currentTime+0.4);
}

// ===== –ú–ï–ù–Æ =====
function startGame(){
 menu.style.display="none";
 canvas.style.display="block";
 reset();
}
function openShop(){
 menu.style.display="none";
 shop.style.display="flex";
 coinsText2.textContent = coins;
}
function closeShop(){
 shop.style.display="none";
 menu.style.display="flex";
}

// ===== –ú–ê–ì–ê–ó–ò–ù =====
function buyColor(){
 if(coins>=20){
  coins-=20;
  owned.c2=true;
  saveProgress();
 }
}
function saveSkin(){
 skin.body1 = c1.value;
 if(owned.c2) skin.body2 = c2.value;
 skin.eyes = eyes.value;
 saveProgress();
}
function saveProgress(){
 localStorage.coins = coins;
 localStorage.owned = JSON.stringify(owned);
 localStorage.skin = JSON.stringify(skin);
 coinsText.textContent = coins;
 coinsText2.textContent = coins;
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï =====
addEventListener("click", jump);
addEventListener("touchstart", jump);

function jump(){
 if(dead) return;
 if(y>=420 || onPlatform()) vy=-16;
}

function onPlatform(){
 return platforms.some(p =>
  180>p.x && 180<p.x+p.w &&
  y+40>=p.y && y+40<=p.y+10
 );
