<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neon Dash</title>

<style>
body{
 margin:0;
 background:#050510;
 font-family:Arial;
 overflow:hidden;
 color:#0ff;
}
canvas{
 display:none;
 margin:auto;
 background:#050510;
}
.menu{
 position:absolute;
 inset:0;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 background:radial-gradient(circle,#0a0a25,#000);
}
button{
 font-size:18px;
 padding:12px 28px;
 margin:8px;
 background:#0ff;
 border:none;
 color:#000;
 box-shadow:0 0 20px #0ff;
 border-radius:8px;
}
h1{text-shadow:0 0 25px #0ff;}
</style>
</head>

<body>

<div class="menu" id="menu">
 <h1>NEON DASH</h1>
 <button onclick="startGame()">▶ ИГРАТЬ</button>
 <p>Монеты: <span id="coinsText">0</span></p>
</div>

<canvas id="game" width="360" height="520"></canvas>

<script>
// ===== ПРОГРЕСС =====
let coins = Number(localStorage.coins || 0);
coinsText.textContent = coins;

// ===== CANVAS =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===== ИГРА =====
let y, vy, dead;
let gravity = 0.9;
let speed = 6;
let progress = 0;
const LEVEL_LENGTH = 2500;

let spikes = [];
let platforms = [];
let particles = [];

// ===== ЗВУК ВЗРЫВА =====
function explosionSound(){
 const a = new AudioContext();
 const o = a.createOscillator();
 const g = a.createGain();
 o.type="sawtooth";
 o.frequency.setValueAtTime(200,a.currentTime);
 o.frequency.exponentialRampToValueAtTime(40,a.currentTime+0.4);
 g.gain.setValueAtTime(0.6,a.currentTime);
 g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+0.4);
 o.connect(g); g.connect(a.destination);
 o.start(); o.stop(a.currentTime+0.4);
}

// ===== МЕНЮ =====
function startGame(){
 menu.style.display="none";
 canvas.style.display="block";
 reset();
}

// ===== УПРАВЛЕНИЕ =====
addEventListener("click", jump);
addEventListener("touchstart", jump);

function jump(){
 if(dead) return;
 if(y>=420 || onPlatform()) vy=-16;
}

function onPlatform(){
 return platforms.some(p =>
  180>p.x && 180<p.x+p.w &&
  y+40>=p.y && y+40<=p.y+10
 );
}

// ===== СМЕРТЬ =====
function die(){
 if(dead) return;
 dead = true;
 vy = 0;

 explosionSound();
 spawnParticles(180, y+20);

 setTimeout(reset, 2000);
}

// ===== ПАРТИКЛЫ =====
function spawnParticles(px,py){
 for(let i=0;i<30;i++){
  particles.push({
   x:px, y:py,
   vx:Math.random()*6-3,
   vy:Math.random()*-6,
   life:40
  });
 }
}

// ===== РЕСТАРТ =====
function reset(){
 y = 420;
 vy = 0;
 dead = false;
 progress = 0;
 spikes = [];
 platforms = [];
 particles = [];
}

// ===== ЦИКЛ =====
function loop(){
 ctx.clearRect(0,0,360,520);

 // ===== ДВИЖЕНИЕ ТОЛЬКО ЕСЛИ ЖИВ =====
 if(!dead){
  progress += speed;

  vy += gravity;
  y += vy;
  if(y>420){ y=420; vy=0; }

  if(Math.random()<0.025) spikes.push({x:360});
  if(Math.random()<0.03) platforms.push({x:360,y:350,w:80});

  spikes.forEach(s=>s.x-=speed);
  platforms.forEach(p=>p.x-=speed);
 }

 // ===== КУБ (НЕ РИСУЕТСЯ ПОСЛЕ СМЕРТИ) =====
 if(!dead){
  ctx.fillStyle="#00ffff";
  ctx.fillRect(160,y,40,40);
  ctx.fillStyle="#ffffff";
  ctx.fillRect(170,y+15,5,5);
  ctx.fillRect(185,y+15,5,5);
 }

 // ===== ПЛАТФОРМЫ =====
 ctx.fillStyle="#ff00ff";
 platforms.forEach(p=>{
  ctx.fillRect(p.x,p.y,p.w,12);
  if(!dead && onPlatform()){
   y=p.y-40;
   vy=0;
  }
 });

 // ===== ШИПЫ =====
 ctx.fillStyle="#ff3333";
 spikes.forEach(s=>{
  ctx.beginPath();
  ctx.moveTo(s.x,460);
  ctx.lineTo(s.x+25,420);
  ctx.lineTo(s.x+50,460);
  ctx.fill();
  if(!dead && s.x<200 && s.x+50>160 && y+40>420){
   die();
  }
 });

 // ===== ПАРТИКЛЫ (ВСЕГДА ДВИГАЮТСЯ) =====
 particles.forEach(p=>{
  p.x+=p.vx;
  p.y+=p.vy;
  p.vy+=0.3;
  p.life--;
  ctx.fillStyle="#00ffff";
  ctx.fillRect(p.x,p.y,3,3);
 });
 particles = particles.filter(p=>p.life>0);

 // ===== ФИНИШ =====
 if(!dead && progress>=LEVEL_LENGTH){
  coins+=25;
  localStorage.coins = coins;
  menu.style.display="flex";
  canvas.style.display="none";
 }

 requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
