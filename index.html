<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neon Dash</title>

<style>
body{
 margin:0;
 background:#050510;
 font-family:Arial;
 overflow:hidden;
 color:#0ff;
}
canvas{
 display:none;
 margin:auto;
 background:#050510;
}
.menu,.shop{
 position:absolute;
 inset:0;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 background:radial-gradient(circle,#0a0a25,#000);
}
button{
 font-size:18px;
 padding:12px 28px;
 margin:8px;
 background:#0ff;
 border:none;
 color:#000;
 box-shadow:0 0 20px #0ff;
 border-radius:8px;
}
h1,h2{
 text-shadow:0 0 25px #0ff;
}
input[type=color]{
 width:60px;
 height:40px;
 margin:5px;
 border:none;
}
</style>
</head>

<body>

<div class="menu" id="menu">
 <h1>NEON DASH</h1>
 <button onclick="startGame()">‚ñ∂ –ò–ì–†–ê–¢–¨</button>
 <button onclick="openShop()">üõí –ú–ê–ì–ê–ó–ò–ù</button>
 <p>–ú–æ–Ω–µ—Ç—ã: <span id="coinsText">0</span></p>
</div>

<div class="shop" id="shop" style="display:none">
 <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
 <p>–ú–æ–Ω–µ—Ç—ã: <span id="coinsText2">0</span></p>

 <button onclick="buyColor()">–ö—É–ø–∏—Ç—å –Ω–µ–æ–Ω-—Ü–≤–µ—Ç (20)</button>

 <div>
  –¶–≤–µ—Ç 1 <input type="color" id="c1">
  –¶–≤–µ—Ç 2 <input type="color" id="c2">
  –ì–ª–∞–∑–∞ <input type="color" id="eyes">
 </div>

 <button onclick="saveSkin()">–°–û–•–†–ê–ù–ò–¢–¨</button>
 <button onclick="closeShop()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<canvas id="game" width="360" height="520"></canvas>

<script>
// ===== –ü–†–û–ì–†–ï–°–° =====
let coins = Number(localStorage.coins || 0);
let owned = JSON.parse(localStorage.owned || '{"c1":true,"c2":false}');
let skin = JSON.parse(localStorage.skin || '{"body1":"#00ffff","body2":"#00aaff","eyes":"#ffffff"}');

coinsText.textContent = coins;
coinsText2.textContent = coins;

c1.value = skin.body1;
c2.value = skin.body2;
eyes.value = skin.eyes;

// ===== CANVAS =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===== –ò–ì–†–ê =====
let y, vy, dead;
let gravity = 0.9;
let speed = 6;
let progress = 0;
const LEVEL_LENGTH = 2500;

let spikes = [];
let platforms = [];
let particles = [];

// ===== –ó–í–£–ö =====
function explosionSound(){
 const a = new AudioContext();
 const o = a.createOscillator();
 const g = a.createGain();
 o.type="sawtooth";
 o.frequency.setValueAtTime(200,a.currentTime);
 o.frequency.exponentialRampToValueAtTime(40,a.currentTime+0.4);
 g.gain.setValueAtTime(0.6,a.currentTime);
 g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+0.4);
 o.connect(g); g.connect(a.destination);
 o.start(); o.stop(a.currentTime+0.4);
}

// ===== –ú–ï–ù–Æ =====
function startGame(){
 menu.style.display="none";
 canvas.style.display="block";
 reset();
}
function openShop(){
 menu.style.display="none";
 shop.style.display="flex";
 coinsText2.textContent = coins;
}
function closeShop(){
 shop.style.display="none";
 menu.style.display="flex";
}

// ===== –ú–ê–ì–ê–ó–ò–ù =====
function buyColor(){
 if(coins>=20){
  coins-=20;
  owned.c2=true;
  saveProgress();
 }
}
function saveSkin(){
 skin.body1 = c1.value;
 if(owned.c2) skin.body2 = c2.value;
 skin.eyes = eyes.value;
 saveProgress();
}
function saveProgress(){
 localStorage.coins = coins;
 localStorage.owned = JSON.stringify(owned);
 localStorage.skin = JSON.stringify(skin);
 coinsText.textContent = coins;
 coinsText2.textContent = coins;
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï =====
addEventListener("click", jump);
addEventListener("touchstart", jump);

function jump(){
 if(dead) return;
 if(y>=420 || onPlatform()) vy=-16;
}

function onPlatform(){
 return platforms.some(p =>
  180>p.x && 180<p.x+p.w &&
  y+40>=p.y && y+40<=p.y+10
 );
}

// ===== –°–ú–ï–†–¢–¨ =====
function die(){
 if(dead) return;
 dead = true;
 vy = 0;

 explosionSound();
 spawnParticles(180, y+20);

 setTimeout(reset, 2000);
}

// ===== –ü–ê–†–¢–ò–ö–õ–´ =====
function spawnParticles(px,py){
 for(let i=0;i<30;i++){
  particles.push({
   x:px, y:py,
   vx:Math.random()*6-3,
   vy:Math.random()*-6,
   life:40
  });
 }
}

// ===== –†–ï–°–¢–ê–†–¢ =====
function reset(){
 y = 420;
 vy = 0;
 dead = false;
 progress = 0;
 spikes = [];
 platforms = [];
 particles = [];
}

// ===== –¶–ò–ö–õ =====
function loop(){
 ctx.clearRect(0,0,360,520);

 if(!dead){
  progress += speed;
  vy += gravity;
  y += vy;
  if(y>420){ y=420; vy=0; }

  if(Math.random()<0.025) spikes.push({x:360});
  if(Math.random()<0.03) platforms.push({x:360,y:350,w:80});
 }

 spikes.forEach(s=>s.x-=speed);
 platforms.forEach(p=>p.x-=speed);

 // –ö–£–ë (–ù–ï –†–ò–°–£–ï–¢–°–Ø –ü–û–°–õ–ï –°–ú–ï–†–¢–ò)
 if(!dead){
  ctx.fillStyle = skin.body1;
  ctx.fillRect(160,y,40,40);
  ctx.fillStyle = skin.body2;
  ctx.fillRect(165,y+5,30,30);
  ctx.fillStyle = skin.eyes;
  ctx.fillRect(170,y+15,5,5);
  ctx.fillRect(185,y+15,5,5);
 }

 // –ü–õ–ê–¢–§–û–†–ú–´
 ctx.fillStyle="#ff00ff";
 platforms.forEach(p=>{
  ctx.fillRect(p.x,p.y,p.w,12);
  if(!dead && onPlatform()){
   y=p.y-40;
   vy=0;
  }
 });

 // –®–ò–ü–´
 ctx.fillStyle="#ff3333";
 spikes.forEach(s=>{
  ctx.beginPath();
  ctx.moveTo(s.x,460);
  ctx.lineTo(s.x+25,420);
  ctx.lineTo(s.x+50,460);
  ctx.fill();
  if(!dead && s.x<200 && s.x+50>160 && y+40>420){
   die();
  }
 });

 // –ü–ê–†–¢–ò–ö–õ–´
 particles.forEach(p=>{
  p.x+=p.vx;
  p.y+=p.vy;
  p.vy+=0.3;
  p.life--;
  ctx.fillStyle=skin.body1;
  ctx.fillRect(p.x,p.y,3,3);
 });
 particles = particles.filter(p=>p.life>0);

 // –§–ò–ù–ò–®
 if(progress>=LEVEL_LENGTH){
  coins+=25;
  saveProgress();
  canvas.style.display="none";
  menu.style.display="flex";
 }

 requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
