<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Dash</title>

<style>
body{
 margin:0;
 background:#050510;
 overflow:hidden;
 font-family:Arial;
}
canvas{
 display:block;
 margin:auto;
 background:#050510;
}
</style>
</head>

<body>

<canvas id="game" width="360" height="520"></canvas>

<script>
const c = document.getElementById("game");
const x = c.getContext("2d");

let y = 420, vy = 0;
let gravity = 0.9;
let speed = 6;
let run = true;

let spikes = [];
let plats = [];
let particles = [];

// === НАСТРОЙКИ СКИНА ===
const skin = {
 body1: "#00ffff",
 body2: "#ff00ff",
 eyes: "#ffffff",
 outline: "#000000"
};

// === ЗВУК ВЗРЫВА ===
function explosionSound(){
 const ctx = new AudioContext();
 const o = ctx.createOscillator();
 const g = ctx.createGain();
 o.type = "sawtooth";
 o.frequency.setValueAtTime(200, ctx.currentTime);
 o.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.3);
 g.gain.setValueAtTime(0.5, ctx.currentTime);
 g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
 o.connect(g);
 g.connect(ctx.destination);
 o.start();
 o.stop(ctx.currentTime + 0.3);
}

// === УПРАВЛЕНИЕ ===
addEventListener("click", jump);
addEventListener("touchstart", jump);

function jump(){
 if(!run) return;
 if(y >= 420 || onPlatform()){
  vy = -16;
 }
}

// === ПРОВЕРКА ПЛАТФОРМ ===
function onPlatform(){
 return plats.some(p =>
  180 > p.x && 180 < p.x + p.w &&
  y + 40 >= p.y && y + 40 <= p.y + 10
 );
}

// === ПАРТИКЛЫ ===
function spawnParticles(px, py){
 for(let i=0;i<20;i++){
  particles.push({
   x:px, y:py,
   vx:Math.random()*6-3,
   vy:Math.random()*-6,
   life:30
  });
 }
}

// === СМЕРТЬ ===
function die(){
 if(!run) return;
 run = false;
 explosionSound();
 spawnParticles(180, y+20);

 setTimeout(()=>{
  y = 420;
  vy = 0;
  spikes = [];
  plats = [];
  particles = [];
  run = true;
  loop();
 },2000);
}

// === ИГРОВОЙ ЦИКЛ ===
function loop(){
 if(!run) return;

 x.clearRect(0,0,360,520);

 // физика
 vy += gravity;
 y += vy;
 if(y > 420){ y = 420; vy = 0; }

 // генерация
 if(Math.random() < 0.03)
  plats.push({x:360, y:350, w:80});
 if(Math.random() < 0.025)
  spikes.push({x:360});

 plats.forEach(p => p.x -= speed);
 spikes.forEach(s => s.x -= speed);

 // === КУБ ===
 x.shadowBlur = 20;
 x.shadowColor = skin.body1;

 x.fillStyle = skin.outline;
 x.fillRect(158, y-2, 44, 44);

 x.fillStyle = skin.body1;
 x.fillRect(160, y, 40, 40);

 x.fillStyle = skin.body2;
 x.fillRect(165, y+5, 30, 30);

 // глаза
 x.fillStyle = skin.eyes;
 x.fillRect(170, y+15, 5, 5);
 x.fillRect(185, y+15, 5, 5);

 // === ПЛАТФОРМЫ ===
 x.shadowColor = "#ff00ff";
 x.fillStyle = "#ff00ff";
 plats.forEach(p=>{
  x.fillRect(p.x, p.y, p.w, 12);
  if(180 > p.x && 180 < p.x + p.w &&
     y + 40 >= p.y && y + 40 <= p.y + vy){
      y = p.y - 40;
      vy = 0;
  }
 });

 // === ШИПЫ ===
 x.shadowColor = "#ff0000";
 x.fillStyle = "#ff0000";
 spikes.forEach(s=>{
  x.beginPath();
  x.moveTo(s.x,460);
  x.lineTo(s.x+25,420);
  x.lineTo(s.x+50,460);
  x.fill();

  if(s.x < 200 && s.x + 50 > 160 && y + 40 > 420){
   die();
  }
 });

 // === ПАРТИКЛЫ ===
 x.shadowBlur = 0;
 particles.forEach(p=>{
  p.x += p.vx;
  p.y += p.vy;
  p.life--;
  x.fillStyle = "#00ffff";
  x.fillRect(p.x, p.y, 3, 3);
 });
 particles = particles.filter(p=>p.life>0);

 requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
